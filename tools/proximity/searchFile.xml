<tool id="edu.tamu.cpt.proximity.searchFile" name="Search File" version="1.0">
    <description>Queries a gff3, genbank, fasta, or blastxml file for a user defined set of terms</description>
    <macros>
	    <import>macros.xml</import>
	    <import>cpt-macros.xml</import>
    </macros>
    <expand macro="requirements">
	    <requirement type="package">gffutils</requirement>
    </expand>
    <command detect_errors="aggressive"><![CDATA[
python $__tool_directory__/searchFile.py
    #if $check is not None:
    --dbaseTerms "$check"
    #end if
    #if $term_add.term_selector == "customtxt":
    --custom_txt "$term_add.custom_txt"
    #elif $term_add.term_selector == "customfile":
    --custom_file "$term_add.custom_file"
    #else:
    #pass
    #end if
    #if $input_file.file_selector == "gff3file":
    --gff3_files "$input_file.gff3_files"
    #elif $input_file.file_selector == "gbkfile":
    --gbk_files "$input_file.gbk_files"
    #elif $input_file.file_selector == "fafile":
    --fa_files "$input_file.fa_files"
    #elif $input_file.file_selector == "blastfile":
    --blast_files "$input_file.blast_files"
    #end if
    --output $output
    ]]></command>
        <inputs>
            <param name="check" type="select" format="text" optional="true" label="Family terms to search" multiple="true" help="Terms avilable to query from the Lysis-family synonym database" display="checkboxes">
                <option value="endolysins" selected="true">Endolysins</option>
                <option value="holins" selected="true">Holins and Anti-holins</option>
                <option value="ECDs" selected="true">N-terminal enzymatic catalytic domains (ECDs)</option>
                <option value="ECDs_accro" selected="true">ECDs acronyms</option>
                <option value="CBDs" selected="true">C-terminal cell wall binding domains (CBDs)</option>
                <option value="CBDs_accro" selected="true">CBDs acronyms</option>
            </param>
            <conditional name="term_add">
                <param name="term_selector" type="select" label="Choose if you'd like to add custom terms">
                    <option value="nocustom" selected="false">No Custom Terms</option>
                    <option value="customtxt" selected="false">Custom Text</option>
                    <option value="customfile" selected="false">Custom File</option>
                </param>
                <when value="customtxt">
                    <param name="custom_txt" label="Custom Text" optional="true" type="text" area="true" help="Custom text box for search terms, must be separated by newline (enter)"/>
                </when>
                <when value="customfile">
                    <param name="custom_file" label="Custom File" optional="true" type="data" format="txt" help="Custom search terms, uploaded via file, where terms must be separated by newline"/>
                </when>
            </conditional>
            <conditional name="input_file">
                <param name="file_selector" type="select" label="Choose if you would like to use a GFF3 File to Analyze">
                    <option value="gff3file" selected="false">GFF3 File</option>
                    <option value="gbkfile" selected="false">Genbank File</option>
                    <option value="fafile" selected="false">FASTA File</option>
                    <option value="blastfile" selected="false">BLAST-xml File</option>
                </param>
                <when value="gff3file">
                    <param name="gff3_files" label="GFF3 Input" type="data" format="gff3" help="gff3 file"/>
                </when>
                <when value="gbkfile">
                    <param name="gbk_files" label="Genbank Input" type="data" format="genbank" help="genbank file"/>
                </when>
                <when value="fafile">
                    <param name="fa_files" label="FASTA Input" type="data" format="fasta" help="fasta file"/>
                </when>
                <when value="blastfile">
                    <param name="blast_files" label="BLAST-xml Input" type="data" format="xml" help="blast-xml file"/>
                </when>
            </conditional>
        </inputs>
        <outputs>
            <data format="txt" name="output" label="termHits.txt"/>
        </outputs>
        <tests>
            <test>
                <param name="check" value="holins"/>
                <param name="custom_file" value="test-data/search.txt"/>
                <param name="custom_txt" value="catalytic"/>
                <param name="gbk_files" value="NC_008720-N4-NCBI.gb"/>
                <param name="fa_files" value="NC_008720-N4-nucleotide.fasta"/>
                <param name="gff3_files" value="NC_008720-N4-NCBI.gff3"/>
                <param name="blast_files" value="Galaxy27-NR.blastxml.xml"/>
                <output name="output" file="output-sample.txt"/>
            </test>
        </tests>
    <help><![CDATA[
INPUT : A user's file(s) of interest (gff3, gbk, fasta, or blast-xml) and query said file(s) with a determined set of search terms. The search terms can be either from the curated lysis synonym database, and/or a custom input via file or text box.

OUTPUT : "termHits.txt" output file has file-type separated returns for features, or lines, that contained hits to a query term.

Options : 
- Endolysins: enzymes that attack one of the structural bonds of the peptidoglycan. The endolysin step requires the hole-forming function of the holins.

- Holins and Anti-holins: small cytoplasmic membrane proteins that control the timing of lysis by forming a lethal membrane hole at a programmed time (programmed into the holin itself).
    ]]></help>
        <citations>
            <citation type="bibtex">
                @unpublished{galaxyTools,
                author = {C. Ross},
                title = {CPT Galaxy Tools},
                year = {2020-},
                note = {https://github.com/tamu-cpt/galaxy-tools/}
                }
            </citation>
        </citations>
</tool>
