<?xml version="1.0"?>
<tool id="edu.tamu.cpt2.gbk.adjacent_features" name="Find adjacent Genbank features" version="RC1">
  <description>Searches a Genbank file for a given FASTA sequence, then outputs a file with adjacent upstream features, and another with adjacent downstream features.</description>
  <macros>
    <import>macros.xml</import>
    <import>cpt-macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <command detect_errors="aggressive"><![CDATA[
python $__tool_directory__/adjacent_features.py
$gbkIn
$fastaIn
$upstreamOut
$downstreamOut
$mode
--numAhead $ahead
--numBack $back
]]></command>
  <inputs>
    <param label="Genbank file" name="gbkIn" type="data" format="genbank"/>
    <param label="Fasta file" name="fastaIn" type="data" format="fasta"/>
    <param label="Number of features upstream to return" name="ahead" type="integer" value="2"/>
    <param label="Number of features downstream to return" name="back" type="integer" value="2"/>
    <param name="mode" type="select" label="Mode">
      <option value="--genesOnly">Search only Gene-type features</option>
      <option value="--cdsOnly">Search only CDS-type features</option>
      <option value="">Search all features (Will most likely cause duplicate results, as this will include sub-features)</option>
    </param>
  </inputs>
  <outputs>
        <data name="upstreamOut" format="fasta" label="upOut"/>
        <data name="downstreamOut" format="fasta" label="downOut"/>
  </outputs>
  <help><![CDATA[
Currently Experimental: Uploaded for review purposes

**What it does**

For a given Fasta file, this tool searches through the features of a Genbank file for one that matches the sequence in the Fasta. If found, it will then output a specified number of features upstream from the hit and a specified number of features downstream as a multifasta file.

It is currently recommended to select either the Gene only or CDS only options for mode, as searching all features will include sub-features of neighbors (ie, selecting 2 for upstream will give you the neighboring gene and then its CDS sub feature, rather than 2 proper neighbors) as well as the sub-features of the search hit itself.

Pending work: Better handling of sub-features to resolve above, and making more informed decisions on when and how to translate the NT sequence in genbank files to match protein Fastas.

]]></help>
		<expand macro="citations" />
</tool>
