<tool id="gff3.rebase" name="Rebase GFF3 features" version="1.1">
  <description>against parent features</description>
  <macros>
    <import>macros.xml</import>
		<import>cpt-macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <command interpreter="python" detect_errors="aggressive"><![CDATA[gff3_rebase.py
$parent
$child

$interpro
$protein2dna
--map_by "$map_by"
> $default]]></command>
  <inputs>
    <param label="Parent GFF3 annotations"                         name="parent" format="gff3" type="data"/>
    <param label="Child GFF3 annotations to rebase against parent" name="child"  format="gff3" type="data"/>

    <param label="Interpro specific modifications" name="interpro" type="boolean" truevalue="--interpro" falsevalue=""/>
    <param label="Map protein translated results to original DNA data" name="protein2dna" type="boolean" truevalue="--protein2dna" falsevalue=""/>

    <param label="Mapping Key" name="map_by" type="text" value="ID" />
  </inputs>
  <outputs>
    <data format="gff3" name="default"/>
  </outputs>
  <tests>
      <test>
          <param name="parent" value="parent.gff"/>
          <param name="child" value="child.gff"/>
          <param name="protein2dna" value="True" />
          <output name="default" file="proteins.gff"/>
      </test>
      <test>
          <param name="parent" value="parent.gff"/>
          <param name="child" value="child.gff"/>
          <output name="default" file="nonprotein.gff"/>
      </test>
  </tests>
  <help><![CDATA[
**What it does**

The workflow in a genomic data analysis typically follows a process like this::
-  select specific features from a genome
-  export only the sequences associated with those regions
-  analyze those exported sequences with a tool like BLAST
- display the results for inspection

For meaningful display in software like JBrowse, it is necessary to accurately map 
those results back to their corresponding positions in the context of the entire 
genome (*e.g.* if a transmembrane domain is detected at bases 10-20 of an analyzed 
protein, where should this be displayed relative to the parent genome?).

This tool fills that gap, by rebasing (calculating coordinates in the parent genome) 
feature (i.e. *child* features) analysis results against the parent features which 
were originally analyzed.

**Example Input/Output**

For a *parent* set of annotations::

#gff-version 3
PhageBob    maker   cds     300     600     .       +       .       ID=cds42

Where the analysis had exported the CDS (child) FASTA sequence:: 

>cds42
MRTNASC

Then analyzed that feature, producing the *child* annotation file::

#gff-version 3
cds42       blastp  match_part      1       50      1e-40   .       .       ID=m00001;Notes=RNAse A Protein

This tool will then localize the results properly against the parent and permit 
proper visualization of the results in the correct location::

#gff-version 3
PhageBob    blastp  match_part      300     449     1e-40   +       .       ID=m00001;Notes=RNAse A Protein

**Options**

The **Interpro** option selectively ignores *features* (*i.e.* polypeptide) and 
qualifiers (status, Target) not needed in the output. 

The **Map Protein** option indicates that the DNA sequences were translated into 
protein sequence during the genomic export process. When this option is selected, 
the tool will multiply the bases by three to obtain the correct DNA locations.

]]></help>
		<expand macro="citations" />
</tool>
