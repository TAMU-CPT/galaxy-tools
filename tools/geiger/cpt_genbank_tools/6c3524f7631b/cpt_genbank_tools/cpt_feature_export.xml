<?xml version="1.0"?>
<tool id="GBKFeatureExport" name="Genbank Feature Export" version="1.94">
  <description>Export features from a Genbank File</description>
  <version_command>perl bin/cpt_feature_export.pl --version</version_command>
  <stdio>
    <exit_code range="1:" level="fatal"/>
  </stdio>
  <command interpreter="perl">bin/cpt_feature_export.pl
--galaxy
--outfile_supporting $__new_file_path__
--file "${file}"

#for $item in $repeat_tag:
--tag "${item.tag}"
#end for

#if $translate:
--translate
#end if

#if $query and $query is not "None":
--query "${query}"
#end if

#if $n_bases_upstream and $n_bases_upstream is not "None":
--n_bases_upstream "${n_bases_upstream}"
#end if

#if $n_bases_downstream and $n_bases_downstream is not "None":
--n_bases_downstream "${n_bases_downstream}"
#end if

#if $strip_stops:
--strip_stops
#end if

--fasta "${fasta}"

--fasta_files_path "${fasta.files_path}"

--fasta_format "${fasta_format}"

--fasta_id "${fasta.id}"

</command>
  <inputs>
    <param name="file" help="Input file" optional="False" label="file" type="data"/>
    <repeat name="repeat_tag" title="Tag">
      <param name="tag" help="Tag to extract" optional="False" label="tag" type="select">
        <option value="operon">operon</option>
        <option value="D-loop">D-loop</option>
        <option value="mobile_element">mobile_element</option>
        <option value="mRNA">mRNA</option>
        <option value="polyA_site">polyA_site</option>
        <option value="transit_peptide">transit_peptide</option>
        <option value="N_region">N_region</option>
        <option value="misc_feature">misc_feature</option>
        <option value="gene">gene</option>
        <option value="unsure">unsure</option>
        <option value="5'UTR">5'UTR</option>
        <option value="CAAT_signal">CAAT_signal</option>
        <option value="sig_peptide">sig_peptide</option>
        <option value="modified_base">modified_base</option>
        <option value="whole">whole</option>
        <option value="stem_loop">stem_loop</option>
        <option value="terminator">terminator</option>
        <option value="gap">gap</option>
        <option value="misc_recomb">misc_recomb</option>
        <option value="repeat_region">repeat_region</option>
        <option value="exon">exon</option>
        <option value="tRNA">tRNA</option>
        <option value="-35_signal">-35_signal</option>
        <option value="prim_transcript">prim_transcript</option>
        <option value="misc_signal">misc_signal</option>
        <option value="old_sequence">old_sequence</option>
        <option value="C_region">C_region</option>
        <option value="tmRNA">tmRNA</option>
        <option value="GC_signal">GC_signal</option>
        <option value="3'UTR">3'UTR</option>
        <option value="attenuator">attenuator</option>
        <option value="source">source</option>
        <option value="assembly_gap">assembly_gap</option>
        <option value="iDNA">iDNA</option>
        <option value="STS">STS</option>
        <option value="J_segment">J_segment</option>
        <option value="CDS">CDS</option>
        <option value="all">all</option>
        <option value="misc_difference">misc_difference</option>
        <option value="intron">intron</option>
        <option value="primer_bind">primer_bind</option>
        <option value="rRNA">rRNA</option>
        <option value="rep_origin">rep_origin</option>
        <option value="promoter">promoter</option>
        <option value="V_region">V_region</option>
        <option value="ncRNA">ncRNA</option>
        <option value="protein_bind">protein_bind</option>
        <option value="variation">variation</option>
        <option value="S_region">S_region</option>
        <option value="precursor_RNA">precursor_RNA</option>
        <option value="D_segment">D_segment</option>
        <option value="RBS">RBS</option>
        <option value="polyA_signal">polyA_signal</option>
        <option value="V_segment">V_segment</option>
        <option value="enhancer">enhancer</option>
        <option value="TATA_signal">TATA_signal</option>
        <option value="-10_signal">-10_signal</option>
        <option value="misc_binding">misc_binding</option>
        <option value="LTR">LTR</option>
        <option value="misc_RNA">misc_RNA</option>
        <option value="mat_peptide">mat_peptide</option>
        <option value="misc_structure">misc_structure</option>
        <option value="oriT">oriT</option>
      </param>
    </repeat>
    <param name="translate" falsevalue="False" optional="True" truevalue="True" checked="" help="Translate the sequence during analysis" type="boolean" label="translate"/>
    <param name="query" help="Optional query to select features. Text entered here will be searched through all tags for selected feature type. Use ? as a single character wildcard, and * as any number of character wildcard" optional="True" label="query" type="text"/>
    <param value="0" name="n_bases_upstream" help="Adds N bases upstream to the result" optional="True" label="n_bases_upstream" type="integer"/>
    <param value="0" name="n_bases_downstream" help="Adds N bases downstream to the result" optional="True" label="n_bases_downstream" type="integer"/>
    <param name="strip_stops" falsevalue="False" optional="True" truevalue="True" checked="" help="Remove all stop codons from translated proteins" label="strip_stops" type="boolean"/>
    <param name="fasta_format" help="Fasta export of selected tag" optional="False" label="Format of fasta" type="select">
      <option value="Fasta" selected="True">Fasta</option>
    </param>
  </inputs>
  <outputs>
    <data name="fasta" format="Fasta">
      <change_format>
        <when input="fasta_format" value="Fasta" format="fasta"/>
      </change_format>
    </data>
  </outputs>
  <help>DESCRIPTION
===========

This tool exports features from a GenBank formatted file. It has the
ability to prepend and append sequence up and downstream of the feature,
as well as a built in sequence translator.

Some downstream tools do not want stop codons included, and will reject
sequences exported from this tool (e.g., blast). If you find this is the
case, simply select ``strip_stops``
</help>
  <tests>
    <test>
      <param name="file" value="test-data/inputs/single.gbk"/>
      <param name="tag" value="CDS"/>
      <param name="fasta" value="test-data/outputs/export.default.fa"/>
    </test>
    <test>
      <param name="file" value="test-data/inputs/single.gbk"/>
      <param name="tag" value="gene"/>
      <param name="translate" value=""/>
      <param name="fasta" value="test-data/outputs/export.translate.fa"/>
    </test>
    <test>
      <param name="file" value="test-data/inputs/split-feature.gbk"/>
      <param name="tag" value="CDS"/>
      <param name="fasta" value="test-data/outputs/export.split.fa"/>
    </test>
    <test>
      <param name="file" value="test-data/inputs/split-feature.gbk"/>
      <param name="tag" value="CDS"/>
      <param name="translate" value=""/>
      <param name="fasta" value="test-data/outputs/export.splittrans.fa"/>
    </test>
    <test>
      <param name="file" value="test-data/inputs/split-feature.gbk"/>
      <param name="n_bases_downstream" value="50"/>
      <param name="n_bases_upstream" value="10"/>
      <param name="tag" value="CDS"/>
      <param name="translate" value=""/>
      <param name="fasta" value="test-data/outputs/export.up_down.fa"/>
    </test>
  </tests>
</tool>
