<tool id="edu.tamu.cpt.genome_viz.linear_genome_plot" name="Linear Genome Plot" version="1.0">
    <description>Linear Genome Plot</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements">
    </expand>
    <command detect_errors="aggressive"><![CDATA[
python $__tool_directory__/linear_genome_plot.py
$input_file
--plot_width $plot_width
--features_excluded $features_excluded
--ignore_labeling $ignore_labeling
--feature_label_order $feature_label_order
--title $title
$label_above
#if $selectregion.custom_region
    --sz $custom_region.start_zoom
    --ez $custom_region.end_zoom
    --st $custom_region.start_translate
    --et $custom_region.end_translate
#end if
#for $feature_color in $feature_colors:
    #if $feature_color.feature_color_selector.feature_id:
        --feature_id $feature_color.feature_color_selector.feature_id
        --feature_id_color $feature_color.feature_color_selector.feature_id_color
    #end if
#end for
#for $gene_color in $gene_colors:
    #if $gene_color.gene_color_selector.gene_id:
        --gene_id $gene_color.gene_color_selector.gene_id
        --gene_id_color $gene_color.gene_color_selector.gene_id_color
    #end if
#end for
--file_stats $file_stats
--out_img $out_img
    ]]></command>
    <inputs>
        <param label="Multi FASTA File" name="input_file" type="data" format="fasta" />
        <param label="Plot Width" name="plot_width" type="int" default="20" help="Width of the plot. Increase for larger genomes." />
        <param label="Plot Height" name="plot_height" type="int" default="4" help="Height of the plot." hidden="true" />
        <param label="Features to EXCLUDE" name="features_excluded" type="text" optional="true" help="Feature(s) to exclude from plot (example: source,gene). Separate by comma(s)." />
        <param label="Names to EXCLUDE" name="ignore_labeling" type="text" optional="true" help="Product names to ignore (example: hypothetical protein). Separate by commas" />
        <param label="Name ordering" help="Order of features to orient naming convention (example: locus_tag,product). Separate by commas." name="feature_label_order" type="txt"/>
        <param label="Title of Graph" name="title" type="txt"/>
        <param label="ALL labels above Gene" name="label_above" type="boolean" help="number schema subscripts" truevalue="--label_above" falsevalue=""/>
        <conditional name="selectregion">
            <param label="Select Custom Region" name="custom_region" type="boolean" default="false" />
            <when value="true">
                <param name="start_zoom" label="Start Zoom" type="int" help="(--sz)" />
                <param name="end_zoom" label="End Zoom" type="int" help="(--ez)" />
                <param name="start_translate" label="Start Translation Site" type="int" help="(--st)" />
                <param name="end_translate" label="End Translation Site" type="int" help="(--et)" />
            </when>
            <when value="false">
            </when>
        </conditional>
        <repeat name="feature_colors" title="Feature Colors">
            <conditional name="feature_color_selector" type="boolean">
                <param name="feature_id" label="Feature Name" type="txt" help="feature name. Example: CDS" />
                <param name="feature_id_color" label="Feature Color" type="color" />
            </conditional>
        </repeat>
        <repeat name="gene_colors" title="gene Colors">
            <conditional name="gene_color_selector" type="boolean">
                <param name="gene_id" label="Feature Name" type="txt" help="gene name. Example: CDS" >
                <param name="gene_id_color" label="Feature Color" type="color" value="#FFFFFF"/>
                    <sanitizer>
                        <valid initial="string.ascii_letters,string.digits">
                            <add value="#" />
                        </valid>
                    </sanitizer>
                </param>
            </conditional>
        </repeat>
    </inputs>
    <outputs>
        <data format="txt" name="file_stats" label="out_stats.txt" />
        <data format="svg" name="out_img" label="genome_plot.svg" />
    </outputs>
        <tests>
            <test>
                <param name="input_file" value="mu_reanno.gb" />
                <param name="plot_width" value="25" />
                <param name="features_excluded" value="misc_feature,misc_difference,source,gene" />
                <param name="ignore_labeling" value="uncharacterized protein" />
                <param name="title" value="Mu Test Plot" />
                <parm name="feature_label_order" value="product" />
                <repeat name="feature_colors" >
                    <conditional name="custom_feature_colors" >
                        <param name="feature_id" value="CDS" />
                        <param name="feature_id_color" value="#FFFFFF" />
                    </conditional>
                </repeat>
                <repeat name="feature_colors" >
                    <conditional name="custom_feature_colors" >
                        <param name="feature_id" value="RBS" />
                        <param name="feature_id_color" value="#CD5C5C" />
                    </conditional>
                </repeat>
                <output name="file_stats" file="out_stats.txt" />
                <output name="out_img" file="out_img.svg" />
            </test>
        </tests>
    <help><![CDATA[
ALPHA VERSION

Genome Plot

Output:
* file_stats will output the different 
    ]]></help>
    <citations>
        <citation type="doi">https://doi.org/10.1101/2020.01.09.900589</citation>
        <citation type="bibtex">
            @unpublished{galaxyTools,
            author = {C. Ross},
            title = {CPT Galaxy Tools},
            year = {2020-},
            note = {https://github.com/tamu-cpt/galaxy-tools/}
            }
        </citation>
    </citations>
</tool>