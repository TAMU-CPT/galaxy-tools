<tool id="edu.tamu.cpt.genome_viz.linear_genome_plot" name="Linear Genome Plot" version="1.0">
    <description>Linear Genome Plot</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements">
    </expand>
    <command detect_errors="aggressive"><![CDATA[
$__tool_directory__/linear_genome_plot.py
$input_file
--plot_width $plot_width
--features_excluded "$features_excluded"
--ignore_labeling "$ignore_labeling"
--feature_label_order "$feature_label_order"
--title "$title"
$label_algo
$no_label_box
#if $selectregion.custom_region:
    --sz $selectregion.start_zoom
    --ez $selectregion.end_zoom
#end if
#for $feature_color in $feature_colors:
    #if $feature_color.feature_color_selector.feature_color_options == "add_colors":
        --feature_id #for $feat_id in $feature_color.feature_color_selector.feature_id:
            "${feat_id}" #end for
        --feature_id_color #for $feat_col in $feature_color.feature_color_selector.feature_id_color:
            "${feat_col}" #end for
    #end if
#end for
#for $gene_color in $gene_colors:
    #if $gene_color.gene_color_selector.gene_color_options == "add_colors":
        --gene_id $gene_color.gene_id
        --gene_id_color $gene_color.gene_id_color
    #end if
#end for
--file_stats $file_stats
--out_img $out_img
    ]]></command>
    <inputs>
        <param label="Annotated Genome File (Gbk or GFF3)" name="input_file" type="data" format="genbank" />
        <param label="Plot Width" name="plot_width" type="integer" value="20" help="Width of the plot. Increase for larger genomes." />
        <!-- <param label="Plot Height" name="plot_height" type="integer" value="4" help="Height of the plot." /> -->
        <param label="No Box Label" name="no_label_box" type="boolean" help="Select 'yes' to have no label box around feature labels" truevalue="--no_label_box" falsevalue="" />
        <param label="Features to EXCLUDE" name="features_excluded" type="text" optional="true" help="Feature(s) to exclude from plot (example: source,gene). Separate by comma(s)." />
        <param label="Products/Names to EXCLUDE" name="ignore_labeling" type="text" optional="true" help="Product names to ignore (example: hypothetical protein). Separate by commas" />
        <param label="Name ordering" help="Order of features to decide naming convention (example: locus_tag,product). Separate by commas." name="feature_label_order" type="text"/>
        <param label="Title of Graph" name="title" type="text"/>
        <param label="Label algorithm dictates label placement" name="label_algo" type="boolean" help="Some features will be displayed inside if there is sufficient space. If set to no, all labels will be placed in the box labels above the feature" truevalue="--label_algo" falsevalue="" />
        <conditional name="selectregion">
            <param label="Select Custom Region" name="custom_region" type="boolean" checked="false" />
            <when value="true">
                <param name="start_zoom" label="Start Zoom" type="integer" help="start zoom" optional="true"/>
                <param name="end_zoom" label="End Zoom" type="integer" help="end zoom" optional="true"/>
                <!--<param name="start_translate" label="Start Translation Site" type="integer" help="start translation" optional="true" /> -->
                <!-- <param name="end_translate" label="End Translation Site" type="integer" help="end translation" optional="true" /> -->
            </when>
            <when value="false">
            </when>
        </conditional>
        <repeat name="feature_colors" title="Feature Colors">
            <conditional name="feature_color_selector">
                <param name="feature_color_options" type="select" label="Feature Color Options">
                    <option value="none" selected="false"></option>
                    <option value="add_colors" selected="false">Add Custom Colors</option>
                </param>
                <when value="add_colors">
                    <param name="feature_id" label="Feature Name" type="text" optional="true" multiple="true" help="Feature name. Example: CDS. Case Sensitive." />
                    <param name="feature_id_color" label="Feature Color" type="color" optional="true" multiple="true" value="#FFFFFF" >
                        <sanitizer>
                            <valid initial="string.ascii_letters,string.digits">
                                <add value="#" />
                            </valid>
                        </sanitizer>
                    </param>
                </when>
                <when value="none">
                </when>
            </conditional>
        </repeat>
        <repeat name="gene_colors" title="Product Name Colors">
            <conditional name="gene_color_selector" >
                <param name="gene_color_options" type="select" label="Product Color Options">
                    <option value="none" selected="false"></option>
                    <option value="add_colors" selected="false">Add Custom Colors</option>
                </param>
                <when value="add_colors">
                    <param name="gene_id" label="Product Name" type="text" optional="true" multiple="true" help="Product Name. Example: holin. Case Sensitive." />
                    <param name="gene_id_color" label="Product Color" type="color" optional="true" multiple="true" value="#CD5C5C" >
                        <sanitizer>
                            <valid initial="string.ascii_letters,string.digits">
                                <add value="#" />
                            </valid>
                        </sanitizer>
                    </param>
                </when>
                <when value="none">
                </when>
            </conditional>
        </repeat>
    </inputs>
    <outputs>
        <data format="text" name="file_stats" label="out_stats.txt" />
        <data format="svg" name="out_img" label="genome_plot.svg" />
    </outputs>
        <tests>
            <test>
                <param name="input_file" value="mu_reanno.gb" />
                <param name="plot_width" value="25" />
                <param name="features_excluded" value="misc_feature,misc_difference,source,gene" />
                <param name="ignore_labeling" value="uncharacterized protein" />
                <param name="title" value="Mu Test Plot" />
                <param name="feature_label_order" value="product" />
                <repeat name="feature_colors" >
                    <conditional name="feature_color_selector" >
                        <param name="feature_color_options" value="add_colors" />
                            <param name="feature_id" value="CDS" />
                            <param name="feature_id_color" value="#FFFFFF" />
                    </conditional>
                </repeat>
                <repeat name="feature_colors" >
                    <conditional name="feature_color_selector" >
                        <param name="feature_color_options" value="add_colors" />
                            <param name="feature_id" value="RBS" />
                            <param name="feature_id_color" value="#CD5C5C" />
                    </conditional>
                </repeat>
                <output name="file_stats" file="out_stats.txt" />
                <output name="out_img" file="out_img.svg" />
            </test>
        </tests>
    <help><![CDATA[
ALPHA VERSION

Genome Plot

Output:

* file_stats will output the different
    ]]></help>
    <citations>
        <citation type="doi">https://doi.org/10.1101/2020.01.09.900589</citation>
        <citation type="bibtex">
            @unpublished{galaxyTools,
            author = {C. Ross},
            title = {CPT Galaxy Tools},
            year = {2020-},
            note = {https://github.com/tamu-cpt/galaxy-tools/}
            }
        </citation>
    </citations>
</tool>
